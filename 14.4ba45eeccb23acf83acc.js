(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"+Iep":function(t,e,n){"use strict";n.r(e),n.d(e,"PaymentModule",function(){return y});var s=n("ofXK"),i=n("mrSG"),o=n("fXoL"),r=n("8OjO"),c=n("c14U"),a=n("5dVO"),b=n("n90K"),d=n("tyNb"),h=n("2MiI");function p(t,e){if(1&t&&(o.Ob(0,"span"),o.ic(1),o.Yb(2,"currency"),o.Nb()),2&t){const t=o.Xb(2);o.yb(1),o.jc(o.Zb(2,1,t.totalAmount))}}function u(t,e){if(1&t&&(o.Ob(0,"li"),o.Ob(1,"span"),o.ic(2),o.Kb(3,"br"),o.ic(4),o.Nb(),o.hc(5,p,3,3,"span",7),o.Nb()),2&t){const t=e.$implicit,n=e.index;o.yb(2),o.jc(t.name),o.yb(2),o.kc("Cant.: ",t.quantity,""),o.yb(1),o.ac("ngIf",0===n)}}let l=(()=>{class t{constructor(t,e,n,s,i){this.crud=t,this.cart=e,this.loader=n,this.storage=s,this.router=i,this.purchase={},this.purchaseId="",this.paymentValid=!1,this.user={},this.articles=[],this.cashPoints=0,this.totalAmount=0}ngOnInit(){return Object(i.a)(this,void 0,void 0,function*(){this.loader.beginLoad();const t=this.storage.get("sh-anon")||this.storage.getKey();this.crud.setBearer(t),yield this.checkPayment(),this.setPurchase(),this.paymentValid?yield this.savePayment():yield this.router.navigate(["payment/error"]),this.loader.endLoad()})}setPurchase(){const t=[{}];t.pop(),this.articles.forEach(e=>{t.push({articleId:e.id,quantity:e.quantity})}),this.purchase={purchasesArticles:t,cashPoints:this.cashPoints}}checkPayment(){return Object(i.a)(this,void 0,void 0,function*(){const t=JSON.parse(this.storage.get("sh-pay"))||null;if(this.storage.delete("sh-pay"),null===t)return yield this.router.navigate(["/"]),void this.loader.endLoad();this.articles=t.articles,this.cashPoints=t.cashPoints,this.crud.setEndpoint("purchases/validate"),yield this.crud.httpGet(`?paymentId=${t.id}`).toPromise().then(t=>Object(i.a)(this,void 0,void 0,function*(){"paid"===t.response.payment_status?this.paymentValid=!0:yield this.router.navigate(["/"])}))})}savePayment(){return Object(i.a)(this,void 0,void 0,function*(){this.crud.setEndpoint("purchases/create"),yield this.crud.httpPost(this.purchase).toPromise().then(t=>{this.user.name=t.response.name,this.user.address=t.response.address,this.user.city=t.response.city,this.user.postalCode=t.response.postalCode,this.purchaseId=t.response.id,this.totalAmount=t.response.totalAmount}).finally(()=>{this.cart.clearCart(),this.storage.delete("sh-cart"),this.storage.delete("sh-anon")})})}}return t.\u0275fac=function(e){return new(e||t)(o.Jb(r.a),o.Jb(c.a),o.Jb(a.a),o.Jb(b.a),o.Jb(d.b))},t.\u0275cmp=o.Db({type:t,selectors:[["app-success"]],decls:33,vars:7,consts:[[1,"container"],[3,"justLogo"],[1,"p-lg-5"],[1,"header"],[1,"text-danger"],[1,"content"],[4,"ngFor","ngForOf"],[4,"ngIf"]],template:function(t,e){1&t&&(o.Ob(0,"div",0),o.Kb(1,"app-header",1),o.Ob(2,"div",2),o.Ob(3,"div",3),o.Ob(4,"span",4),o.ic(5,"*"),o.Nb(),o.Ob(6,"p"),o.ic(7,"P\xe1gina de confirmaci\xf3n de orden"),o.Nb(),o.Nb(),o.Ob(8,"div",5),o.Ob(9,"h2"),o.ic(10,"Nombre y Direcci\xf3n"),o.Nb(),o.Ob(11,"ul"),o.Ob(12,"li"),o.ic(13),o.Nb(),o.Ob(14,"li"),o.ic(15),o.Nb(),o.Ob(16,"li"),o.ic(17),o.Nb(),o.Ob(18,"li"),o.ic(19),o.Nb(),o.Nb(),o.Nb(),o.Ob(20,"div",5),o.Ob(21,"h2"),o.ic(22,"Figuras compradas"),o.Nb(),o.Ob(23,"ul"),o.hc(24,u,6,3,"li",6),o.Nb(),o.Nb(),o.Ob(25,"div",5),o.Ob(26,"h2"),o.ic(27,"Confirmaci\xf3n"),o.Nb(),o.Ob(28,"p"),o.ic(29,"N\xfamero de Orden"),o.Nb(),o.Ob(30,"p"),o.Ob(31,"strong"),o.ic(32),o.Nb(),o.Nb(),o.Nb(),o.Nb(),o.Nb()),2&t&&(o.yb(1),o.ac("justLogo",!0),o.yb(12),o.jc(e.user.name),o.yb(2),o.jc(e.user.address),o.yb(2),o.jc(e.user.city),o.yb(2),o.jc(e.user.postalCode),o.yb(5),o.ac("ngForOf",e.articles),o.yb(8),o.jc(e.purchaseId))},directives:[h.a,s.i,s.j],pipes:[s.c],styles:[".header[_ngcontent-%COMP%]{align-items:center;border-bottom:2px solid #ececec;display:flex;margin-bottom:1rem;padding-bottom:1rem}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#707070;font-size:1.75rem;font-weight:700}.content[_ngcontent-%COMP%]{margin-bottom:3rem}.content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#707070;font-family:sans-serif;font-size:1.25rem;font-weight:700;margin-bottom:1rem}.content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#707070;font-size:1.5rem;text-transform:uppercase}.content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{border-left:1px solid #707070;width:100%}.content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#707070;display:flex;justify-content:space-between;margin-bottom:1.75rem;width:100%}"]}),t})(),m=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Db({type:t,selectors:[["app-error"]],decls:11,vars:1,consts:[[1,"container"],[3,"justLogo"],[1,"row","text-center"],[1,"text-danger"],["routerLink","/"]],template:function(t,e){1&t&&(o.Ob(0,"div",0),o.Kb(1,"app-header",1),o.Ob(2,"div",2),o.Ob(3,"h1",3),o.ic(4,"Error!"),o.Nb(),o.Ob(5,"h2",3),o.ic(6,"No se pudo completar tu pago"),o.Nb(),o.Ob(7,"p"),o.ic(8,"No se te realizo ningun cobro"),o.Nb(),o.Ob(9,"a",4),o.ic(10,"Regresar"),o.Nb(),o.Nb(),o.Nb()),2&t&&(o.yb(1),o.ac("justLogo",!0))},directives:[h.a,d.d],styles:[""]}),t})();var g=n("j1ZV");const O=[{path:"success",component:l},{path:"error",component:m}];let y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Hb({type:t}),t.\u0275inj=o.Gb({imports:[[s.b,d.e.forChild(O),g.a]]}),t})()}}]);