(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{tcQp:function(t,e,i){"use strict";i.r(e),i.d(e,"CheckoutModule",function(){return m});var n=i("ofXK"),o=i("mrSG"),r=i("quSY"),s=i("AytR"),c=i("fXoL"),a=i("c14U"),l=i("5dVO"),d=i("3LUQ"),h=i("tyNb"),b=i("8OjO"),u=i("n90K"),p=i("2MiI"),g=i("3Pt+");function _(t,e){if(1&t&&(c.Ob(0,"div",7),c.Ob(1,"div",17),c.Ob(2,"div",18),c.Kb(3,"img",19),c.Ob(4,"div",20),c.Ob(5,"p",21),c.ic(6),c.Nb(),c.Ob(7,"p",21),c.ic(8),c.Nb(),c.Nb(),c.Nb(),c.Ob(9,"p",22),c.ic(10),c.Yb(11,"currency"),c.Nb(),c.Nb(),c.Nb()),2&t){const t=e.$implicit;c.yb(3),c.ac("src",null==t.images[0]?null:t.images[0].path,c.fc),c.yb(3),c.jc(null==t?null:t.name),c.yb(2),c.kc("Cant.: ",null==t?null:t.quantity,""),c.yb(2),c.kc(" ",void 0!==t.price&&void 0!==t.discountPrice&&void 0!==t.quantity?c.Zb(11,4,(t.price-t.discountPrice)*t.quantity):0," ")}}function O(t,e){if(1&t){const t=c.Pb();c.Ob(0,"div",23),c.Ob(1,"div",24),c.Ob(2,"input",25),c.Vb("change",function(){return c.ec(t),c.Xb().togglePayPoints()})("ngModelChange",function(e){return c.ec(t),c.Xb().payWithPoints=e}),c.Nb(),c.Ob(3,"label",26),c.ic(4," Pagar con Puntos "),c.Nb(),c.Nb(),c.Ob(5,"span"),c.ic(6),c.Yb(7,"currency"),c.Nb(),c.Nb()}if(2&t){const t=c.Xb();c.yb(2),c.ac("ngModel",t.payWithPoints),c.yb(4),c.kc("Se descontaria el equivalente a ",c.Zb(7,2,t.points.totalValid||t.pendingPoints)," MXN")}}let f=(()=>{class t{constructor(t,e,i,n,o,s){this.cart=t,this.loader=e,this.alert=i,this.router=n,this.crud=o,this.storage=s,this.articles=[],this.points={totalExpired:0,totalValid:0},this.user={},this.cartEdit=!1,this.subscription=new r.a,this.payWithPoints=!1,this.pendingPoints=0,this.total=0}ngOnInit(){return Object(o.a)(this,void 0,void 0,function*(){this.loader.beginLoad();const t=this.storage.get("sh-anon");t?this.crud.setBearer(t):(yield this.getUser(),yield this.getPoints()),t||this.user.name&&this.user.city&&this.user.postalCode&&this.user.city&&this.user.address&&this.user.phone?(window.document.body.style.overflowY="auto",this.getCartArticles(),this.loader.endLoad()):yield this.router.navigate(["pre-checkout"]).finally(()=>this.loader.endLoad())})}getCartArticles(){this.subscription=this.cart.cart$.subscribe(t=>{this.articles=t,this.updateTotals()})}updateTotals(){this.total=0,this.articles.forEach(t=>{void 0!==t.price&&void 0!==t.quantity&&void 0!==t.discountPrice&&(this.total+=(t.price-t.discountPrice)*t.quantity)})}getUser(){return Object(o.a)(this,void 0,void 0,function*(){const t=this.storage.getKey();if(!t||t.length<50)return this.loader.endLoad(),void this.storage.deleteKey();this.crud.setEndpoint("user"),this.crud.setBearer(t),yield this.crud.httpGet("","La sesi\xf3n caduco").toPromise().then(t=>{this.user=t.error?{}:t.response}).catch(()=>this.storage.deleteKey())})}ngOnDestroy(){this.subscription.unsubscribe()}pay(){if(0===this.articles.length)return;this.loader.beginLoad();const t={articles:this.articles,errorUrl:s.a.errorUrl,payWithPoints:this.payWithPoints,successUrl:s.a.successUrl};this.crud.setEndpoint("purchases/checkout"),this.crud.httpPost(t).toPromise().then(t=>{this.storage.set("sh-pay",JSON.stringify(t.response)),window.location.replace(t.response.sessionUrl)}).finally(()=>this.loader.endLoad())}openCart(){this.cartEdit=!0}cartClosed(){this.cartEdit=!1}getPoints(){return Object(o.a)(this,void 0,void 0,function*(){this.crud.setEndpoint("user/points"),yield this.crud.httpGet().toPromise().then(t=>{t.response&&(this.points=t.response)})})}togglePayPoints(){if(this.payWithPoints){const t=this.total-this.points.totalValid;return this.pendingPoints=this.points.totalValid,void(t<0?(this.points.totalValid=-1*t,this.total=0):(this.total-=this.points.totalValid,this.points.totalValid=0))}this.updateTotals(),this.points.totalValid=this.pendingPoints}}return t.\u0275fac=function(e){return new(e||t)(c.Jb(a.a),c.Jb(l.a),c.Jb(d.a),c.Jb(h.b),c.Jb(b.a),c.Jb(u.a))},t.\u0275cmp=c.Db({type:t,selectors:[["app-checkout"]],decls:29,vars:9,consts:[[1,"container-fluid"],[3,"justLogo","cartEdit","cartClosed"],[1,"p-lg-5"],[1,"title"],["routerLink","/articles"],[1,"box"],[1,"box_purchase"],[1,"box_purchase_row"],[1,"resume"],[1,"edit",3,"click"],["class","box_purchase_row",4,"ngFor","ngForOf"],[1,"p-3"],[1,"left-col"],[1,"left-col_dark"],[1,"right-col"],["class","row p-3 points form-group",4,"ngIf"],[1,"w-100","btn","btn-lg","btn-danger",3,"disabled","click"],[1,"box_purchase_row_article"],[1,"left"],["alt","figura shinsekai",3,"src"],[1,"box_purchase_row_article_details"],[1,"detail"],[1,"price"],[1,"row","p-3","points","form-group"],[1,"form-group","d-flex","align-items-center"],["id","pp","name","payWithPoints","type","checkbox",1,"form-check",3,"ngModel","change","ngModelChange"],["for","pp"]],template:function(t,e){1&t&&(c.Ob(0,"div",0),c.Ob(1,"app-header",1),c.Vb("cartClosed",function(){return e.cartClosed()}),c.Nb(),c.Ob(2,"div",2),c.Ob(3,"div",3),c.Ob(4,"h1"),c.ic(5,"Finalizar Compra"),c.Nb(),c.Ob(6,"a",4),c.ic(7,"Seguir comprando"),c.Nb(),c.Nb(),c.Ob(8,"div",5),c.Ob(9,"div",6),c.Ob(10,"div",7),c.Ob(11,"p",8),c.ic(12),c.Nb(),c.Ob(13,"span",9),c.Vb("click",function(){return e.openCart()}),c.ic(14,"Editar carrito"),c.Nb(),c.Nb(),c.hc(15,_,12,6,"div",10),c.Ob(16,"div",11),c.Kb(17,"hr"),c.Nb(),c.Ob(18,"div",7),c.Ob(19,"div",12),c.Ob(20,"p",13),c.ic(21," Total: "),c.Nb(),c.Nb(),c.Ob(22,"div",14),c.ic(23),c.Yb(24,"currency"),c.Nb(),c.Nb(),c.hc(25,O,8,4,"div",15),c.Nb(),c.Nb(),c.Ob(26,"div",11),c.Ob(27,"button",16),c.Vb("click",function(){return e.pay()}),c.ic(28,"Continuar"),c.Nb(),c.Nb(),c.Nb(),c.Nb()),2&t&&(c.yb(1),c.ac("justLogo",!0)("cartEdit",e.cartEdit),c.yb(11),c.kc("Resumen del pedido (",e.articles.length,")"),c.yb(3),c.ac("ngForOf",e.articles),c.yb(8),c.kc(" ",c.Zb(24,7,e.total)," "),c.yb(2),c.ac("ngIf",e.points.totalValid>0||e.pendingPoints>0),c.yb(2),c.ac("disabled",0===e.articles.length))},directives:[p.a,h.d,n.i,n.j,g.a,g.h,g.j],pipes:[n.c],styles:[".title[_ngcontent-%COMP%]{align-items:center;display:flex;font-weight:700;justify-content:space-around;margin-bottom:1.5rem}.title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#707070}.title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#e62121;text-decoration:underline}.box[_ngcontent-%COMP%]{padding:1rem}.box_purchase[_ngcontent-%COMP%]{background:#ececec}.box_purchase_row[_ngcontent-%COMP%]{align-items:center;color:#707070;display:flex;justify-content:space-around;padding:1.5rem}.box_purchase_row[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]{cursor:pointer;font-size:.9rem;text-decoration:underline}.box_purchase_row[_ngcontent-%COMP%]   .edit[_ngcontent-%COMP%]:hover{color:#2b304a}.box_purchase_row_article[_ngcontent-%COMP%]{justify-content:space-around;width:100%}.box_purchase_row_article[_ngcontent-%COMP%], .box_purchase_row_article[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{align-items:center;display:flex}.box_purchase_row_article[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:auto;margin-right:1rem;object-fit:contain;width:10rem}.box_purchase_row_article_details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#707070;font-size:.875rem}.box_purchase_row[_ngcontent-%COMP%]   .left-col_dark[_ngcontent-%COMP%], .box_purchase_row[_ngcontent-%COMP%]   .right-col[_ngcontent-%COMP%]{color:#2b304a;font-size:1.25rem;font-weight:700}.points[_ngcontent-%COMP%]{color:#707070}.points[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;font-size:1.5rem;margin-left:1rem}.points[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{transform:scale(1.2)}@media only screen and (max-width:500px){h1[_ngcontent-%COMP%]{font-size:1.5rem;width:100%}.box_purchase_row_article[_ngcontent-%COMP%]{flex-direction:column}.box_purchase_row_article[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-bottom:1rem;width:5rem}}"]}),t})();var P=i("j1ZV");const y=[{path:"",component:f}];let m=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.Hb({type:t}),t.\u0275inj=c.Gb({imports:[[h.e.forChild(y),n.b,P.a,g.f]]}),t})()}}]);